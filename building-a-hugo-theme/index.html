<!doctype html><html class=sticky id=root><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://coderyihaowang.github.io/building-a-hugo-theme/><meta name=generator content="Hugo 0.82.1"><title>Yihao | Building a Hugo Theme</title><link rel=stylesheet href=https://coderyihaowang.github.io/css/normalize.min.css><link rel=stylesheet href=https://coderyihaowang.github.io/css/chroma.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=JetBrains+Mono"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora"><link rel=stylesheet href=https://coderyihaowang.github.io/css/custom.min.css><style>body{visibility:hidden;opacity:0}</style><script>window.baseURL="https://coderyihaowang.github.io"</script></head><body><header><div class=menu-container><span class=command-container><span title="Command Pallete" id=title>Yihao
<span class=command>></span></span>
<input id=command class=command-input></input></span><nav class=menu-items-container><li><a class=menu-item href=https://coderyihaowang.github.io/><span>Home</span></a></li><li><a class="menu-item current" href=https://coderyihaowang.github.io/blog/><span>Blog</span></a></li><li><a class=menu-item href=https://coderyihaowang.github.io/tags/><span>Tags</span></a></li><li><a class=menu-item href=https://coderyihaowang.github.io/projects><span>Projects</span></a></li></nav><a href=javascript:void(0) onclick=menu() class=icon>&#9776;</a></div></header><div id=content><div class=article-container><div class=article-table-of-contents-container><div class=article-table-of-contents><nav id=TableOfContents><ul><li><a href=#mental-model>Mental model</a></li><li><a href=#providing-information>Providing information</a><ul><li><a href=#information-in-contents>Information in contents</a></li><li><a href=#information-in-config>Information in config</a></li><li><a href=#information-from-hugo-engine>Information from Hugo engine</a></li></ul></li><li><a href=#grouping-information>Grouping information</a></li><li><a href=#rendering-information>Rendering information</a></li><li><a href=#wrap-up>Wrap up</a></li></ul></nav></div></div><div class=article-main><h1 class=article-title>Building a Hugo Theme</h1><div class=article-info-container><span class=article-info>1274 words</span> &bull;
<span class=article-info>6 min reading</span> &bull;
<span class=article-info>Published: Apr 10, 2021</span> &bull;
<span class=article-info>Last modified: Apr 27, 2021</span><div class=article-tags-container><a class="tag article-tag" href=https://coderyihaowang.github.io/tags/#hugo>hugo</a>
<a class="tag article-tag" href=https://coderyihaowang.github.io/tags/#go>go</a>
<a class="tag article-tag" href=https://coderyihaowang.github.io/tags/#theme>theme</a></div></div><div class=article-content-container><p>I&rsquo;ve built a <a href=https://gohugo.io/>Hugo</a> theme, <a href=https://coderyihaowang.github.io/yBlog>yBlog</a>, for my personal blog. Here are some take-aways.</p><h2 id=mental-model>Mental model</h2><p>As a content writer, we write contents in markdown, put them in correct folders, add some meta-data in front matter, and that&rsquo;s it. Hugo takes care of everything else for us. But if we want to build our own themes, we need to understand a bit more about how Hugo works behind the scenes. The below diagram show my mental model when I use Hugo:</p><p><img src=https://coderyihaowang.github.io/images/Hugo-mental-model.png alt></p><p>This is perhaps an over-simplified version of Hugo&rsquo;s work flow. If you look at <a href=https://github.com/gohugoio/hugo>Hugo&rsquo;s source code</a>, you&rsquo;ll find the actual implementation much more complicated. But I find this mental model helpful for getting us thinking in Hugo.</p><p>To summarise Hugo&rsquo;s model in one sentence: <strong>everything is a page</strong>, and every page has a corresponding model that provides all the information needed to render it. This model is really the central piece of Hugo&rsquo;s flow. Everything you write will become its fields, and everything you see on the rendered pages are retrieved from it. You provide data to the model by writing markdown (including front matter), and you retrieve data in the templates by accessing the model&rsquo;s fields and methods. Unfortunately, you won&rsquo;t be able to find this &ldquo;model&rdquo; in any documentation, because it only exists in our mental model, the real implementation is much more sophisticated. You can refer to <a href=https://gohugo.io/variables/>variables in hugo</a>, they are corresponding to the model &ldquo;fields&rdquo; that we are talking about here.</p><p>So, let&rsquo;s have a closer look at the data flow around this model, it can be separated into three steps (as shown in the diagram above):</p><ol><li><p>Hugo parses the markdown contents and the front matter, as well as the config file, gathering information into models (providing information)</p></li><li><p>Models are mapped to corresponding templates (grouping information)</p></li><li><p>Templates consume the information carried in the models, rendering them in HTML (rendering information)</p></li></ol><h2 id=providing-information>Providing information</h2><p>Information is the raw material for building the website. They come from 3 sources: the content markdown files, the <code>config.toml/yaml/json</code> file, and the Hugo engine.</p><h3 id=information-in-contents>Information in contents</h3><p>The most notable piece of information is the markdown content itself. This content will be available as a page variable, and can be retrieved using <code>.Content</code> in the page template (will explain shortly).</p><p>We are also able to provide other information that is specific to a particular page. These are added as <a href=https://gohugo.io/content-management/front-matter>front matter</a> at the top of the content file. Some fields are <a href=https://gohugo.io/content-management/front-matter#front-matter-formats>predefined</a> by Hugo, including <code>title</code>, <code>description</code> and so on. When they are defined in the front matter, they are available for use in templates via their names (eg <code>.Title</code>, <code>.Description</code>, &mldr;).</p><p>Other than these predefined fields, we can also add whatever information we want to front matter. These user-defined fields will also be available in the page template. They are grouped together in the <code>.Params</code> field. For example, if we add a <code>note</code> field to front matter, as this is not Hugo predefiend, we can later use it via <code>.Params.Note</code> in the templates.</p><h3 id=information-in-config>Information in config</h3><p>We&rsquo;ll also need some information that are website-wise, for example, the base URL of the website, the website&rsquo;s author, etc. They belong to the <code>config.toml</code> file. When you provide these fields in the config file, they become available via the <code>.Site</code> template variable. For example, <code>baseURL = 'https://my.domain'</code> in <code>config.toml</code> becomes <code>.Site.BaseURL</code> in the templates.</p><h3 id=information-from-hugo-engine>Information from Hugo engine</h3><p>During the building process, Hugo also adds a great amount of helpful information for us to use in templates. These include <code>.Permalink</code>, <code>.TableOfContents</code>, <code>.WordCount</code>, <code>.ReadingTime</code> and many more. Refer to the documentation of <a href=https://gohugo.io/variables/page/>page variables</a> and <a href=https://gohugo.io/variables/site/>site variables</a> to see what else are available.</p><h2 id=grouping-information>Grouping information</h2><p>The information gathered from the above step will be grouped into models and dispatched to templates. Basically, the templates come in two versions (<code>Kind</code>s, in Hugo&rsquo;s term): single page templates and list templates.</p><p><strong>Single page templates</strong> display individual contents. For example, a single markdown file that you put under the contents folder will be forwarded to a single page template.</p><p><strong>List templates</strong> don&rsquo;t display the content of an individual content file; they are used to provide a summary page of a certain collection. For example, section, taxonomy, etc. For example, the <a href=https://coderyihaowang.github.io/yBlog/blog>blogs</a> page of the example site of my theme is rendered by a list template. That said, you CAN create a file corresponding to a particular list template; this way, you can provide front matter to the model of a list page. <a href=https://gohugo.io/templates/lists/#add-content-and-front-matter-to-list-pages>see here</a></p><p>By default, you should see these three default template files under the <code>layouts/_default</code> folder:</p><pre><code>_default/
  |- single.html
  |- list.html
  `- baseof.html
</code></pre><p><code>single.html</code> is the default single page template. Your individual content pages will be rendered by this template. <code>list.html</code> is the default list template, you can use it to display the summary of a section. Obviously, Hugo supports many other types of templates, but those are basically special cases of either single page template or list page template. You can read more about Hugo&rsquo;s template lookup order <a href=https://gohugo.io/templates/lookup-order/>here</a>.</p><p>Note here <code>baseof.html</code> is the base of all other templates. You can add the elements common to all pages here, like the head part of html. Other templates can be embedded inside this one. We&rsquo;ll explain more of template structuring in the next section.</p><h2 id=rendering-information>Rendering information</h2><p>Finally, the models go to corresponding templates, and we can retrieve the information we provided earlier in the contents and config file. To retrieve a field in model and insert it into the template, put it inside a pair of mustache symbol: <code>{{ }}</code>. For example, <code>&lt;h1>{{ .Title }}&lt;/h1></code> in the template will be rendered as <code>&lt;h1>[value of the model's 'title' field]&lt;/h1></code> in the final output. Hugo uses Go&rsquo;s <a href=https://golang.org/pkg/text/template/>templating language</a>, which is very powerful and interesting to work with. You can read about it in <a href=https://gohugo.io/templates/introduction/>Hugo&rsquo;s documentation</a>.</p><p>Hugo&rsquo;s templates can be embedded and make use of <a href=https://gohugo.io/templates/partials/>partials</a> to reuse components. To show an example, here is the <code>baseof.html</code> of my theme:</p><div class=highlight><pre class=chroma><code class=language-html data-lang=html><span class=cp>&lt;!DOCTYPE html&gt;</span>
<span class=p>&lt;</span><span class=nt>html</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;sticky&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;root&#34;</span><span class=p>&gt;</span>
    {{- partial &#34;head.html&#34; . -}}
    <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
        {{- partial &#34;header.html&#34; . -}}
        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;content&#34;</span><span class=p>&gt;</span>
        {{- block &#34;main&#34; . }}{{- end }}
        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
        {{- partial &#34;footer.html&#34; . -}}
        {{- partial &#34;script.html&#34; . -}}
    <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</code></pre></div><p>The <code>{{- block "main" . }}{{- end }}</code> part shows how to use blocks to define the outer shell of a template. My <code>_default/single.html</code> is defined as:</p><div class=highlight><pre class=chroma><code class=language-html data-lang=html>{{ define &#34;main&#34; }}
    <span class=c>&lt;!-- content of a single page --&gt;</span>
{{ end }}
</code></pre></div><p>The content of the single page template will be embedded into <code>baseof.html</code> template in the <code>block "main" .</code> part. The dot (<code>.</code>) after <code>"main"</code> is the context passed to embedded templates (similar to function argument, but each template only has one context). You can read more about base template and blocks <a href=https://gohugo.io/templates/base/>here</a></p><p>The <code>{{- partial "script.html" . -}}</code> part shows how to use partial templates. I have created a <code>script.html</code> template under the <code>partials</code> folder with the following content:</p><div class=highlight><pre class=chroma><code class=language-html data-lang=html>{{ $script := resources.Get &#34;/js/script.js&#34; | minify }}
<span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;{{ $script.RelPermalink }}&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</code></pre></div><p>This piece will be inserted into the <code>partial "script.html ."</code> part. This way, we can decouple parts of a template and improve maintainability.</p><p>You can read more about partial templates <a href=https://gohugo.io/templates/partials/>here</a>.</p><h2 id=wrap-up>Wrap up</h2><p>Right, that&rsquo;s it. This article is not a step-by-step toturial but aims to provide a high level overview of how Hugo works. There are a lot of details I cannot cover here, but it summarises what I learned so far, and hopefully it will be useful when I leave Hugo for some time and come back one day. For detailed information on Hugo, go to the <a href=https://gohugo.io/documentation/>documentation</a>, and they also have a good <a href=https://gohugo.io/getting-started/quick-start/>tutorial</a> to get you started.</p></div><div class=article-footer-container><span>Prev:<a href=https://coderyihaowang.github.io/help/> Command Pallete Reference Manual</a></span>
<span></span></div></div><div></div></div></div><footer><div><span>Made with <a href=https://gohugo.io/>Hugo</a> •</span>
<span>Themed with <a href=https://github.com/CoderYihaoWang/yBlog>yBlog</a> •</span>
<span>Content in <a href=https://github.com/CoderYihaoWang/coderyihaowang.github.io>GitHub</a></span></div><div><span>Last updated Apr 27, 2021</span>
<span>&bull; Commit <a href=https://github.com/coderyihaowang/coderyihaowang.github.io/commit/669e47d80ed4432642547cb71ae3c6584392677e>669e47d</a>:
Fix image link</span></div></footer><script src=https://coderyihaowang.github.io/js/script.min.js></script></body></html>